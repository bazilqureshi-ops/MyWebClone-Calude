@using Emse.QMagic.Web.Models;
@{
	List<qmAutoTransferRule> transferRoutes = ViewBag.model;
}

<link href="~/assets/css/sweetalert2.min.css" rel="stylesheet" />
<script src="~/assets/js/sweetalert2.all.min.js"></script>

<div class="row">
	<div class="col-xs-12 col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3">
		<div class="card">
			<div class="card-header">
				Auto Transfer List
			</div>
			<div class="card-body no-padding">
				<table class="datatable table table-striped primary" cellspacing="0" width="100%">
					<thead>
						<tr>
							<th>Auto Transfer Route Name</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						@{
							if (transferRoutes.Count > 0)
							{
								foreach (var item in transferRoutes)
								{
									<tr>
										<td>@item.AutoTransferName</td>

										<td width="200">
											<a href="../AutoTransferRoute/EditTransferRoute?id=@item.AutoTransferRuleID" class="btn btn-default"><span class="fa fa-pencil"></span></a>
											<button type="button" value="@item.AutoTransferRuleID" class="btn btn-danger"><span class="fa fa-remove"></span></button>
										</td>
									</tr>
								}
							}
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>


<div class="btn-floating" id="help-actions">
	<div class="btn-bg"></div>
	<button type="button" class="btn btn-default btn-toggle" data-toggle="toggle" data-target="#help-actions">
		<i class="icon fa fa-plus"></i>
		<span class="help-text">Shortcut</span>
	</button>
	<div class="toggle-content">
		<ul class="actions">
			<li><a href="/AutoTransferRoute/CreateTransferRoute">Create a New Transfer Route</a></li>
		</ul>
	</div>
</div>


<script>
	//Delete User Function
	$('.btn-danger').click(function () {
		var id = $(this).val();

		swal({
			title: "You're deleting this ATR!",
			text: "If you delete this Auto Transfer Route, related tickets will lose their ATR information. Please ensure before delete this ATR!",
			icon: "warning",
			buttons: true,
			dangerMode: true,
		})
			.then((willDelete) => {
				if (willDelete) {

					$.ajax({
						type: "POST",
						url: "/AutoTransferRoute/DeleteAtr",
						dataType: "JSON",
						data: "ID=" + id,
						success: function (result) {
							if (result === "deleted") {
								swal({
									icon: "success",
									title: "This Auto Transfer Route successfully deleted.",
									buttons: {
										ok: "Confirm"
									}
								}).then(redirect => {
									window.location = "/AutoTransferRoute";
								});



							}
						}
					});

				} else {
					swal({
						title: "Canceled",
						icon: "info",
					});
				}
			});
	});
</script>