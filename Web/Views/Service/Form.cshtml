@using System.Web.Services.Description
@model Emse.QMagic.Web.Domain.Viewmodels.ServiceViewModel

<script>
    $(document).on('submit', 'form', function () {
        var button = $(this).find(':submit');
        setTimeout(function () {
            button.attr('disabled', 'disabled');
        }, 0);
    });
</script>

<link href="~/assets/css/sweetalert2.min.css" rel="stylesheet" />
<script src="~/assets/js/sweetalert2.all.min.js"></script>
<script>
    $(document).ready(function () {
        var designcount = @(Model.Designs.Count());

        if (designcount < 1) {
            var str = "<p>You're not meeting the minimum requirements of creating a new service. You should have at least one ticket design.</p>";

            if (designcount < 1) {
                str += "Please <a href = '../TicketDesigner' > click here</a> to create new auto ticket design.<br /> ";
            }

            swal({
                title: "Hmm.. Consider This",
                text: str,
                icon: "warning",
                buttons: false,
                dangerMode: true,
                content: str
            });

            $(".swal-text").html(str);
        }

        $(".24hour").click(function () {
            if ($(".24hour").prop("checked")) {
                $(".worktime").prop("disabled", true);
                $(".resettime").prop("disabled", true);

                $("#Service_WorkTimeStart").val("00:00:01");
                $("#Service_WorkTimeFinish").val("23:59:59");
            }
            else {
                $(".worktime").prop("disabled", false);
                $(".resettime").prop("disabled", false);
            }
        });
    });
</script>

<div class="row">
    <div class="col-xs-10 col-xs-offset-1">
        @if (!string.IsNullOrEmpty(ViewBag.Error))
        {

            var data = ViewBag.Entity;

            <div class="alert-danger" style="margin-bottom: 10px;">
                <label style="padding: 10px">
                    @ViewBag.Error <a href="/Service/EditService?id=@data.ServiceID">here.</a>
                </label>
            </div>

        }

        <div class="card">
            <div class="card-header">
                @if (Model.Service.ServiceID > 0)
                {
                    <label>
                        Update Service
                    </label>
                }
                else
                {
                    <label>
                        Create a New Service
                    </label>
                }
            </div>
            <div class="card-body">
                <form action="~/Service/Save" method="post">
                    @Html.HiddenFor(service => service.Service.ServiceID)
                    @Html.HiddenFor(service => service.OldServiceName)

                    @for (int i = 0; i < Model.Designs.Count; i++)
                    {
                        <input type="hidden" name="Designs[@i].ScreenDesignID" value="@Model.Designs[i].ScreenDesignID" />
                        <input type="hidden" name="Designs[@i].DesignName" value="@Model.Designs[i].DesignName" />
                    }

                    <div class="row">
                        <div class="col-xs-12 col-md-12 col-lg-12">
                            <div class="col-xs-12 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Service Code</label>
                                    <div class="col-md-9">
                                        @Html.EditorFor(model => model.Service.ServiceCode, new { htmlAttributes = new { @class = "form-control" } })
                                        <label class="text-danger">
                                            @Html.ValidationMessageFor(model => model.Service.ServiceCode)
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Service Name</label>
                                    <div class="col-md-9">
                                        @Html.EditorFor(model => model.Service.ServiceName, new { htmlAttributes = new { @class = "form-control" } })
                                        <label class="text-danger">
                                            @Html.ValidationMessageFor(model => model.Service.ServiceName)
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Work Time</label>
                                    <div class="col-md-9">
                                        <div class="col-md-6" style="padding:0px;">
                                            @Html.EditorFor(model => model.Service.WorkTimeStart, new { htmlAttributes = new { @class = "form-control time worktime" } })
                                            <label class="text-danger">
                                                @Html.ValidationMessageFor(model => model.Service.WorkTimeStart)
                                            </label>
                                        </div>
                                        <div class="col-md-6" style="padding:0px;">
                                            @Html.EditorFor(model => model.Service.WorkTimeFinish, new { htmlAttributes = new { @class = "form-control time worktime" } })
                                            <label class="text-danger">
                                                @Html.ValidationMessageFor(model => model.Service.WorkTimeFinish)
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Pause Time</label>
                                    <div class="col-md-9">
                                        <div class="col-md-6" style="padding:0px;">
                                            @Html.EditorFor(model => model.Service.PauseStart, new { htmlAttributes = new { @class = "form-control time" } })
                                            <label class="text-danger">
                                                @Html.ValidationMessageFor(model => model.Service.PauseStart)
                                            </label>
                                        </div>
                                        <div class="col-md-6" style="padding:0px;">
                                            @Html.EditorFor(model => model.Service.PauseEnd, new { htmlAttributes = new { @class = "form-control time" } })
                                            <label class="text-danger">
                                                @Html.ValidationMessageFor(model => model.Service.PauseEnd)
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Reset Times</label>
                                    <div class="col-md-9">
                                        <div class="col-md-6" style="padding:0px;">
                                            @Html.EditorFor(model => model.Service.ResetTime, new { htmlAttributes = new { @class = "form-control time resettime" } })
                                            <label class="text-danger">
                                                @Html.ValidationMessageFor(model => model.Service.ResetTime)
                                            </label>
                                        </div>
                                        <div class="col-md-6" style="padding:0px;">
                                            @Html.EditorFor(model => model.Service.Reset2Time, new { htmlAttributes = new { @class = "form-control time resettime" } })
                                            <label class="text-danger">
                                                @Html.ValidationMessageFor(model => model.Service.Reset2Time)
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Service Prefix</label>
                                    <div class="col-md-9">
                                        @Html.EditorFor(model => model.Service.ServicePrefix, new { htmlAttributes = new { @class = "form-control" } })
                                        <label class="text-danger">
                                            @Html.ValidationMessageFor(model => model.Service.ServicePrefix)
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Ticket Range</label>
                                    <div class="col-md-9">
                                        <div class="col-md-6" style="padding:0px;">
                                            @Html.EditorFor(model => model.Service.TicketStartNumber, new { htmlAttributes = new { @class = "form-control" } })
                                            <label class="text-danger">
                                                @Html.ValidationMessageFor(model => model.Service.TicketStartNumber)
                                            </label>
                                        </div>
                                        <div class="col-md-6" style="padding:0px;">
                                            @Html.EditorFor(model => model.Service.TicketFinishNumber, new { htmlAttributes = new { @class = "form-control" } })
                                            <label class="text-danger">
                                                @Html.ValidationMessageFor(model => model.Service.TicketFinishNumber)
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Ticket Design</label>
                                    <div class="col-md-9">
                                        <select class="form-control select2" name="Service.ScreenDesignID">
                                            @{
                                                for (int i = 0; i < Model.Designs.Count; i++)
                                                {
                                                    <option value="@Model.Designs[i].ScreenDesignID">@Model.Designs[i].DesignName</option>
                                                }
                                            }
                                        </select>
                                        <label class="text-danger">
                                            @Html.ValidationMessageFor(model => model.Service.ScreenDesignID)
                                        </label>
                                        <p>&nbsp;</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-md-12 col-lg-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">Repeatable</label>
                                    <div class="col-md-10">
                                        @Html.CheckBoxFor(model => model.Service.Repeatable, new { htmlAttributes = new { @class = "form-control" } })
                                        <span>* If this option is checked, system will never stop giving tickets even reaches the maximum number and keeps giving tickets from the minimum again.</span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-md-12 col-lg-12">
                                <div class="form-group">
                                    <label class="col-md-2 control-label">24 Hours Serving</label>
                                    <div class="col-md-10">
                                        @Html.CheckBoxFor(model => model.Service.Is24Hours, new { @class = "24hour" })
                                        <span>* This option will disable work time and reset time features.</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-footer text-right">
                            <div class="form-group">
                                <div class="col-md-9 col-md-offset-3">
                                    <a href="../Service" class="btn btn-default">Cancel</a>
                                    <button type="submit" class="btn btn-primary">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('.datetime').datetimepicker({
            locale: 'ru',
            format: "YYYY-MM-DD HH:mm:ss"
        });

        $('.date').datetimepicker({
            locale: 'ru',
            format: "YYYY-MM-DD"
        });

        $('.time').datetimepicker({
            locale: 'ru',
            format: "HH:mm:ss"
        });
    });

</script>