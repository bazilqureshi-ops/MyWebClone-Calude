@using Emse.QMagic.Web.Models;
@model Emse.QMagic.Web.Models.qmTerminal
@{
    ViewBag.Title = "Assign Main Display";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<qmTerminal> terminals = ViewBag.data;
    List<qmMDResponsibility> groupitems = ViewBag.dataitems;
    List<qmBranch> branches = ViewBag.branches;
    List<qmInterface> interfaces = ViewBag.Interfaces;
}

<script>
    function AddToList() {
        var terminalid = $("#TerminalSelector").val();
        var arrow = $("#ArrowDirections").val();
        var fakeid = $("#FakeID").val();
        var interfaceid = $("#InterfaceSelector").val();

        var terminalname = $("#TerminalSelector option:selected").text();
        var interfacename = $("#InterfaceSelector option:selected").text();

        var optval = terminalid + "_" + arrow + "_" + fakeid + "_" + interfaceid;
        var opttext = terminalname + " (" + arrow + ") (" + fakeid + ") (" + interfaceid + ")";


        $('#TerminalList').append("<option  selected='selected' value='" + optval + "'>" + opttext + "</option>");
        $("#ItemTable").append("<tr id='Item_" + optval + "'><td>" + terminalname + "</td><td>" + interfacename + "</td><td>" + arrow + "</td><td>" + fakeid + "</td><td><a href='#' onclick='RemoveItem(\"" + optval + "\");' class='btn btn-warning'><i class='fa fa-remove'></i></a></td></tr>");
    }

    function RemoveItem(ItemVal) {
        $("#TerminalList option[value='" + ItemVal + "']").remove();
        $("#Item_" + ItemVal).remove();
    }

    $(document).on('submit', 'form', function () {
        var button = $(this).find(':submit');
        setTimeout(function () {
            button.attr('disabled', 'disabled');
        }, 0);
    });
</script>

<link href="~/assets/css/sweetalert2.min.css" rel="stylesheet" />
<script src="~/assets/js/sweetalert2.all.min.js"></script>
<script>
    $(document).ready(function () {
        var terminalcount = @(terminals.Count());
        var interfacecount = @(interfaces.Count());
        var branchcount = @(branches.Count());

        if (branchcount < 1 || interfacecount < 1 || terminalcount < 1) {
            var str = "<p>You're not meeting the minimum requirements of assigning main display. You should have at least one branch, interface and a terminal.</p>";

            if (branchcount < 1) {
                str += "Please < a href = '../Branch' > click here</a > to create new branch.< br /> ";
            }
            if (interfacecount < 1) {
                str += "Please <a href='../Hardware/Interface'>click here</a> to create new service.<br/>";
            }
            if (terminalcount < 1) {
                str += "Please <a href='../Terminal'>click here</a> to create new terminal.<br/>";
            }

            swal({
                title: "Hmm.. Consider This",
                text: str,
                icon: "warning",
                buttons: false,
                dangerMode: true,
                content: str
            });

            $(".swal-text").html(str);
        }
    });
</script>


<div class="row">
    <div class="col-xs-12">
        <div class="card">
            <div class="card-header">
                Assign Main Display Management
            </div>
            <div class="card-body">
                @using (Html.BeginForm())
                {
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="col-xs-4" style="padding-left:0px;">
                                <select name="TerminalSelector" id="TerminalSelector" class="select2" style="width:100%;">
                                    @foreach (qmTerminal item in terminals)
                                    {
                                        <option value="@item.TerminalID">[@(branches.Where(x=>x.BranchID == Convert.ToInt32(item.BranchID)).FirstOrDefault().BranchName)] [@(item.TerminalLocation)] @(item.TerminalName)</option>
                                    }
                                </select>
                            </div>
                            <div class="col-xs-3">
                                <select name="InterfaceSelector" id="InterfaceSelector" class="select2" style="width:100%;">
                                    @foreach (qmInterface item in interfaces)
                                    {
                                        <option value="@item.InterfaceID">[@(branches.Where(x=>x.BranchID == Convert.ToInt32(item.BranchID)).FirstOrDefault().BranchName)] @(item.InterfaceName)</option>
                                        //@(item.InterfaceName.Contains(" [OVERLOADED]") == true ? "disabled" : "")
                                    }
                                </select>
                            </div>
                            <div class="col-xs-2">
                                <select name="ArrowDirections" id="ArrowDirections" class="select2" style="width:100%">
                                    <option value="Up">Up</option>
                                    <option value="Down">Down</option>
                                    <option value="Left">Left</option>
                                    <option value="Right">Right</option>
                                </select>
                            </div>
                            <div class="col-xs-2">
                                <input type="number" class="form-control" name="FakeID" id="FakeID" min="0" max="999" value="0" />
                            </div>
                            <div class="col-xs-1">
                                <a href="javascript:return;" class="btn btn-danger" onclick="AddToList();"><i class="fa fa-plus"></i></a>
                            </div>
                        </div>
                        <div class="col-xs-12" style="margin-bottom:20px;">
                            <table width="100%" border="1" cellpadding="0" cellspacing="0" id="ItemTable">
                                <tr>
                                    <th>Terminal</th>
                                    <th>Interface</th>
                                    <th>Arrow Direction</th>
                                    <th>Fake ID</th>
                                    <th>Remove</th>
                                </tr>
                                @{
                                    foreach (qmMDResponsibility item in groupitems)
                                    {
                                        <tr id="Item_@(item.TerminalID)_@(item.ArrowDirection)_@(item.FakeID)_@(item.InterfaceID)">
                                            <td>[@(branches.Where(x => x.BranchID == Convert.ToInt32(terminals.Where(y=>y.TerminalID == item.TerminalID).FirstOrDefault().BranchID)).FirstOrDefault().BranchName)] [@(terminals.Where(x => x.TerminalID == item.TerminalID).FirstOrDefault().TerminalLocation)] @(terminals.Where(x => x.TerminalID == item.TerminalID).FirstOrDefault().TerminalName)</td>
                                            <td>[@(branches.Where(x => x.BranchID == Convert.ToInt32(interfaces.Where(y=>y.InterfaceID == item.InterfaceID).FirstOrDefault().BranchID)).FirstOrDefault().BranchName)] @(interfaces.Where(x => x.InterfaceID == item.InterfaceID).FirstOrDefault().InterfaceName)</td>
                                            <td>@(item.ArrowDirection)</td>
                                            <td>@(item.FakeID)</td>
                                            <td><a href="javascript:return;" onclick="RemoveItem('@(item.TerminalID)_@(item.ArrowDirection)_@(item.FakeID)_@(item.InterfaceID)');" class="btn btn-warning"><i class="fa fa-remove"></i></a></td>
                                        </tr>
                                    }
                                }
                            </table>

                            <select name="TerminalList" id="TerminalList" multiple="multiple" style="display:none;">
                                @{
                                    foreach (qmMDResponsibility item in groupitems)
                                    {
                                        <option selected="selected" value="@(item.TerminalID)_@(item.ArrowDirection)_@(item.FakeID)_@(item.InterfaceID)">
                                            Responsibility Itemt
                                        </option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="form-footer text-right" style="margin-top:20px;">
                            <div class="form-group">
                                <div class="col-md-9 col-md-offset-3">
                                    <a href="../Hardware/MainDisplay" class="btn btn-default">Cancel</a>
                                    <button type="submit" class="btn btn-primary">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
