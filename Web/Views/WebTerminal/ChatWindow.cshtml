@using Emse.QMagic.Web.Models;
@{
    Layout = null;

    qmUser senderuser = ViewBag.senderuser;
    qmTerminal senderterminal = ViewBag.senderterminal;
    qmUser receiveruser = ViewBag.receiveruser;
    qmTerminal receiverterminal = ViewBag.receiverterminal;
    List<qmChat> chathistory = ViewBag.chathistory;
    string message = ViewBag.message;
    string rightlocation = ViewBag.rightlocation;
}

<div class="PrivateChatWindow" id="CW_@(receiveruser.UserID)" style="right:@(rightlocation)px;">
    <div class="col-md-12" style="height:7%; padding:0px;">
        <div class="col-md-10" style="padding:0px; color:#FFFFFF; font-weight:bold;">
            <span class="fa fa-comment"></span> @(receiveruser.FullName)
        </div>
        <div class="col-md-2 text-right" style="padding:0px;">
            <span class="fa fa-minus" onclick="ToggleChatWindow(@(receiveruser.UserID));" style="color:#FFF; font-size:16px;"></span>  
            <span class="fa fa-remove" onclick="CloseChatWindow(@(receiveruser.UserID));" style="color:#FFF; font-size:16px;"></span>
        </div>
    </div>
    <div class="col-md-12 PrivateChatWindowChatList" id="ChatBaloons_@(receiveruser.UserID)" style="height:80%; background-color:#FFFFFF; border-radius:5px; padding:10px; overflow-y:scroll;">
        @{
            foreach (qmChat item in chathistory)
            {
                if (item.SenderUserID == senderuser.UserID)
                {
                    <b>@(senderuser.FullName) : </b>@(item.Message)<br />
                }
                if (item.SenderUserID == receiveruser.UserID)
                {
                    <b>@(receiveruser.FullName) : </b>@(item.Message)<br />
                }
            }
        }
        <hr />
        @{
            if (message != "")
            {
                <b>@(receiveruser.FullName) : </b>@(message)<br />
            }
        }
    </div>
    <div class="col-md-12" style="height:10%; background-color:#FFFFFF; border-radius:5px; margin-top:10px; padding:0px;">
        <input type="text" name="MyMessageText" id="MyMessageText_@(receiveruser.UserID)" class="ChatTextArea" style="border-style:none; width:100%; height:100%; border-radius:5px; resize:none; padding:5px; font-family:'Segoe UI'; font-size:13px;"/>
    </div>
</div>


<script>
    $("#MyMessageText_@(receiveruser.UserID)").on('keypress', function (e) {
        if (e.which === 13) {
            var mess = $("#MyMessageText_@(receiveruser.UserID)").val();

            SendChatMessage(@(senderterminal.TerminalID), @(senderuser.UserID),@(receiverterminal.TerminalID),@(receiveruser.UserID), mess);

            $.get("WebTerminal/ChatBaloon", { UserID: @(senderuser.UserID), Message: mess }, function (data) {
                $("#ChatBaloons_" + @(receiveruser.UserID)).append(data);
            });

            $("#ChatBaloons_" + @(receiveruser.UserID)).animate({ scrollTop: $("#ChatBaloons_" + @(receiveruser.UserID)).prop('scrollHeight') });

            $("#MyMessageText_@(receiveruser.UserID)").val("");
        }
    });

    $("#ChatBaloons_" + @(receiveruser.UserID)).animate({ scrollTop: $("#ChatBaloons_" + @(receiveruser.UserID)).prop('scrollHeight') });

    //$("#CW_@(receiveruser.UserID)").draggable();
    //$("#CW_@(receiveruser.UserID)").resizable();
</script>